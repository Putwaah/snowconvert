-- transient=true
{{ config(
    materialized='table',
    transient=true,
    pre_hook=[
        "CALL DEV.LH2_EXPLOIT_DEV.SET_GLOBAL_VAR_PROC('S','OU_DETAILS_TEMP','LH2_SILVER_DEV.OU_DETAILS_TEMP','BEGIN','10')",
        "CALL DEV.LH2_EXPLOIT_DEV.WRITE_LOG_PROC()"
    ],
    post_hook=[
        "CALL DEV.LH2_EXPLOIT_DEV.SET_GLOBAL_VAR_PROC('S','OU_DETAILS_TEMP','LH2_SILVER_DEV.OU_DETAILS_TEMP','COMPLETED','90',NULL::VARCHAR,NULL::VARCHAR,NULL::TIMESTAMP_NTZ,NULL::TIMESTAMP_NTZ,(SELECT COUNT(*) FROM {{ this }}))",
        "CALL DEV.LH2_EXPLOIT_DEV.WRITE_LOG_PROC()"
    ]
) }}


-- voir pour ajouter exception Ã 
SELECT
         HOU.BUSINESS_GROUP_ID                     HOU_BUSINESS_GROUP_ID,
         HOU.ORGANIZATION_ID                       HOU_ORGANIZATION_ID,
         HOU.NAME                                  HOU_NAME,
         HOU.DATE_FROM                             HOU_DATE_FROM,
         HOU.DATE_TO                               HOU_DATE_TO,
         HOU.SHORT_CODE                            HOU_SHORT_CODE,
         HOU.SET_OF_BOOKS_ID                       HOU_SET_OF_BOOKS_ID,
         HOU.DEFAULT_LEGAL_CONTEXT_ID              HOU_DEFAULT_LEGAL_CONTEXT_ID,
         HOU.USABLE_FLAG                           HOU_USABLE_FLAG,
         HAOU.ORGANIZATION_ID                      HAOU_ORGANIZATION_ID,
         HAOU.BUSINESS_GROUP_ID                    HAOU_BUSINESS_GROUP_ID,
         HAOU.COST_ALLOCATION_KEYFLEX_ID           HAOU_COST_ALLOCATION_KEYFLEX_ID,
         HAOU.LOCATION_ID                          HAOU_LOCATION_ID,
         HAOU.SOFT_CODING_KEYFLEX_ID               HAOU_SOFT_CODING_KEYFLEX_ID,
         HAOU.DATE_FROM                            HAOU_DATE_FROM,
         HAOU.NAME                                 HAOU_NAME,
         HAOU.DATE_TO                              HAOU_DATE_TO,
         HAOU.INTERNAL_EXTERNAL_FLAG               HAOU_INTERNAL_EXTERNAL_FLAG,
         HAOU.INTERNAL_ADDRESS_LINE                HAOU_INTERNAL_ADDRESS_LINE,
         HAOU.TYPE                                 HAOU_TYPE,
         HAOU.REQUEST_ID                           HAOU_REQUEST_ID,
         HAOU.PROGRAM_APPLICATION_ID               HAOU_PROGRAM_APPLICATION_ID,
         HAOU.PROGRAM_ID                           HAOU_PROGRAM_ID,
         HAOU.PROGRAM_UPDATE_DATE                  HAOU_PROGRAM_UPDATE_DATE,
         HAOU.ATTRIBUTE_CATEGORY                   HAOU_ATTRIBUTE_CATEGORY,
         HAOU.ATTRIBUTE1                           HAOU_ATTRIBUTE1,
         HAOU.ATTRIBUTE2                           HAOU_ATTRIBUTE2,
         HAOU.ATTRIBUTE3                           HAOU_ATTRIBUTE3,
         HAOU.ATTRIBUTE4                           HAOU_ATTRIBUTE4,
         HAOU.ATTRIBUTE5                           HAOU_ATTRIBUTE5,
         HAOU.ATTRIBUTE6                           HAOU_ATTRIBUTE6,
         HAOU.ATTRIBUTE7                           HAOU_ATTRIBUTE7,
         HAOU.ATTRIBUTE8                           HAOU_ATTRIBUTE8,
         HAOU.ATTRIBUTE9                           HAOU_ATTRIBUTE9,
         HAOU.ATTRIBUTE10                          HAOU_ATTRIBUTE10,
         HAOU.ATTRIBUTE11                          HAOU_ATTRIBUTE11,
         HAOU.ATTRIBUTE12                          HAOU_ATTRIBUTE12,
         HAOU.ATTRIBUTE13                          HAOU_ATTRIBUTE13,
         HAOU.ATTRIBUTE14                          HAOU_ATTRIBUTE14,
         HAOU.ATTRIBUTE15                          HAOU_ATTRIBUTE15,
         HAOU.ATTRIBUTE16                          HAOU_ATTRIBUTE16,
         HAOU.ATTRIBUTE17                          HAOU_ATTRIBUTE17,
         HAOU.ATTRIBUTE18                          HAOU_ATTRIBUTE18,
         HAOU.ATTRIBUTE19                          HAOU_ATTRIBUTE19,
         HAOU.ATTRIBUTE20                          HAOU_ATTRIBUTE20,
         HAOU.LAST_UPDATE_DATE                     HAOU_LAST_UPDATE_DATE,
         HAOU.LAST_UPDATED_BY                      HAOU_LAST_UPDATED_BY,
         HAOU.LAST_UPDATE_LOGIN                    HAOU_LAST_UPDATE_LOGIN,
         HAOU.CREATED_BY                           HAOU_CREATED_BY,
         HAOU.CREATION_DATE                        HAOU_CREATION_DATE,
         HAOU.OBJECT_VERSION_NUMBER                HAOU_OBJECT_VERSION_NUMBER,
         HAOU.PARTY_ID                             HAOU_PARTY_ID,
         HAOU.COMMENTS                             HAOU_COMMENTS,
         HAOU.ATTRIBUTE21                          HAOU_ATTRIBUTE21,
         HAOU.ATTRIBUTE22                          HAOU_ATTRIBUTE22,
         HAOU.ATTRIBUTE23                          HAOU_ATTRIBUTE23,
         HAOU.ATTRIBUTE24                          HAOU_ATTRIBUTE24,
         HAOU.ATTRIBUTE25                          HAOU_ATTRIBUTE25,
         HAOU.ATTRIBUTE26                          HAOU_ATTRIBUTE26,
         HAOU.ATTRIBUTE27                          HAOU_ATTRIBUTE27,
         HAOU.ATTRIBUTE28                          HAOU_ATTRIBUTE28,
         HAOU.ATTRIBUTE29                          HAOU_ATTRIBUTE29,
         HAOU.ATTRIBUTE30                          HAOU_ATTRIBUTE30,
         HLA.LOCATION_ID                           HLA_LOCATION_ID,
         HLA.LOCATION_CODE                         HLA_LOCATION_CODE,
         HLA.BUSINESS_GROUP_ID                     HLA_BUSINESS_GROUP_ID,
         HLA.DESCRIPTION                           HLA_DESCRIPTION,
         HLA.SHIP_TO_LOCATION_ID                   HLA_SHIP_TO_LOCATION_ID,
         HLA.SHIP_TO_SITE_FLAG                     HLA_SHIP_TO_SITE_FLAG,
         HLA.RECEIVING_SITE_FLAG                   HLA_RECEIVING_SITE_FLAG,
         HLA.BILL_TO_SITE_FLAG                     HLA_BILL_TO_SITE_FLAG,
         HLA.IN_ORGANIZATION_FLAG                  HLA_IN_ORGANIZATION_FLAG,
         HLA.OFFICE_SITE_FLAG                      HLA_OFFICE_SITE_FLAG,
         HLA.DESIGNATED_RECEIVER_ID                HLA_DESIGNATED_RECEIVER_ID,
         HLA.INVENTORY_ORGANIZATION_ID             HLA_INVENTORY_ORGANIZATION_ID,
         HLA.TAX_NAME                              HLA_TAX_NAME,
         HLA.INACTIVE_DATE                         HLA_INACTIVE_DATE,
         HLA.STYLE                                 HLA_STYLE,
         HLA.ADDRESS_LINE_1                        HLA_ADDRESS_LINE_1,
         HLA.ADDRESS_LINE_2                        HLA_ADDRESS_LINE_2,
         HLA.ADDRESS_LINE_3                        HLA_ADDRESS_LINE_3,
         HLA.TOWN_OR_CITY                          HLA_TOWN_OR_CITY,
         HLA.COUNTRY                               HLA_COUNTRY,
         HLA.POSTAL_CODE                           HLA_POSTAL_CODE,
         HLA.REGION_1                              HLA_REGION_1,
         HLA.REGION_2                              HLA_REGION_2,
         HLA.REGION_3                              HLA_REGION_3,
         HLA.TELEPHONE_NUMBER_1                    HLA_TELEPHONE_NUMBER_1,
         HLA.TELEPHONE_NUMBER_2                    HLA_TELEPHONE_NUMBER_2,
         HLA.TELEPHONE_NUMBER_3                    HLA_TELEPHONE_NUMBER_3,
         HLA.LOC_INFORMATION13                     HLA_LOC_INFORMATION13,
         HLA.LOC_INFORMATION14                     HLA_LOC_INFORMATION14,
         HLA.LOC_INFORMATION15                     HLA_LOC_INFORMATION15,
         HLA.LOC_INFORMATION16                     HLA_LOC_INFORMATION16,
         HLA.LOC_INFORMATION17                     HLA_LOC_INFORMATION17,
         HLA.ATTRIBUTE_CATEGORY                    HLA_ATTRIBUTE_CATEGORY,
         HLA.ATTRIBUTE1                            HLA_ATTRIBUTE1,
         HLA.ATTRIBUTE2                            HLA_ATTRIBUTE2,
         HLA.ATTRIBUTE3                            HLA_ATTRIBUTE3,
         HLA.ATTRIBUTE4                            HLA_ATTRIBUTE4,
         HLA.ATTRIBUTE5                            HLA_ATTRIBUTE5,
         HLA.ATTRIBUTE6                            HLA_ATTRIBUTE6,
         HLA.ATTRIBUTE7                            HLA_ATTRIBUTE7,
         HLA.ATTRIBUTE8                            HLA_ATTRIBUTE8,
         HLA.ATTRIBUTE9                            HLA_ATTRIBUTE9,
         HLA.ATTRIBUTE10                           HLA_ATTRIBUTE10,
         HLA.ATTRIBUTE11                           HLA_ATTRIBUTE11,
         HLA.ATTRIBUTE12                           HLA_ATTRIBUTE12,
         HLA.ATTRIBUTE13                           HLA_ATTRIBUTE13,
         HLA.ATTRIBUTE14                           HLA_ATTRIBUTE14,
         HLA.ATTRIBUTE15                           HLA_ATTRIBUTE15,
         HLA.ATTRIBUTE16                           HLA_ATTRIBUTE16,
         HLA.ATTRIBUTE17                           HLA_ATTRIBUTE17,
         HLA.ATTRIBUTE18                           HLA_ATTRIBUTE18,
         HLA.ATTRIBUTE19                           HLA_ATTRIBUTE19,
         HLA.ATTRIBUTE20                           HLA_ATTRIBUTE20,
         HLA.GLOBAL_ATTRIBUTE_CATEGORY             HLA_GLOBAL_ATTRIBUTE_CATEGORY,
         HLA.GLOBAL_ATTRIBUTE1                     HLA_GLOBAL_ATTRIBUTE1,
         HLA.GLOBAL_ATTRIBUTE2                     HLA_GLOBAL_ATTRIBUTE2,
         HLA.GLOBAL_ATTRIBUTE3                     HLA_GLOBAL_ATTRIBUTE3,
         HLA.GLOBAL_ATTRIBUTE4                     HLA_GLOBAL_ATTRIBUTE4,
         HLA.GLOBAL_ATTRIBUTE5                     HLA_GLOBAL_ATTRIBUTE5,
         HLA.GLOBAL_ATTRIBUTE6                     HLA_GLOBAL_ATTRIBUTE6,
         HLA.GLOBAL_ATTRIBUTE7                     HLA_GLOBAL_ATTRIBUTE7,
         HLA.GLOBAL_ATTRIBUTE8                     HLA_GLOBAL_ATTRIBUTE8,
         HLA.GLOBAL_ATTRIBUTE9                     HLA_GLOBAL_ATTRIBUTE9,
         HLA.GLOBAL_ATTRIBUTE10                    HLA_GLOBAL_ATTRIBUTE10,
         HLA.GLOBAL_ATTRIBUTE11                    HLA_GLOBAL_ATTRIBUTE11,
         HLA.GLOBAL_ATTRIBUTE12                    HLA_GLOBAL_ATTRIBUTE12,
         HLA.GLOBAL_ATTRIBUTE13                    HLA_GLOBAL_ATTRIBUTE13,
         HLA.GLOBAL_ATTRIBUTE14                    HLA_GLOBAL_ATTRIBUTE14,
         HLA.GLOBAL_ATTRIBUTE15                    HLA_GLOBAL_ATTRIBUTE15,
         HLA.GLOBAL_ATTRIBUTE16                    HLA_GLOBAL_ATTRIBUTE16,
         HLA.GLOBAL_ATTRIBUTE17                    HLA_GLOBAL_ATTRIBUTE17,
         HLA.GLOBAL_ATTRIBUTE18                    HLA_GLOBAL_ATTRIBUTE18,
         HLA.GLOBAL_ATTRIBUTE19                    HLA_GLOBAL_ATTRIBUTE19,
         HLA.GLOBAL_ATTRIBUTE20                    HLA_GLOBAL_ATTRIBUTE20,
         HLA.LAST_UPDATE_DATE                      HLA_LAST_UPDATE_DATE,
         HLA.LAST_UPDATED_BY                       HLA_LAST_UPDATED_BY,
         HLA.LAST_UPDATE_LOGIN                     HLA_LAST_UPDATE_LOGIN,
         HLA.CREATED_BY                            HLA_CREATED_BY,
         HLA.CREATION_DATE                         HLA_CREATION_DATE,
         HLA.ENTERED_BY                            HLA_ENTERED_BY,
         HLA.TP_HEADER_ID                          HLA_TP_HEADER_ID,
         HLA.ECE_TP_LOCATION_CODE                  HLA_ECE_TP_LOCATION_CODE,
         HLA.OBJECT_VERSION_NUMBER                 HLA_OBJECT_VERSION_NUMBER,
         HLA.GEOMETRY                              HLA_GOEMETRY,
         HLA.LOC_INFORMATION18                     HLA_LOC_INFORMATION18,
         HLA.LOC_INFORMATION19                     HLA_LOC_INFORMATION19,
         HLA.LOC_INFORMATION20                     HLA_LOC_INFORMATION20,
         HLA.DERIVED_LOCALE                        HLA_DERIVED_LOCALE ,
         HLA.LEGAL_ADDRESS_FLAG                    HLA_LEGAL_ADDRESS_FLAG,
         HLA.TIMEZONE_CODE                         HLA_TIMEZONE_CODE,
         GSOB.SET_OF_BOOKS_ID                      GSOB_SET_OF_BOOKS_ID,
         GSOB.NAME                                 GSOB_NAME,
         GSOB.SHORT_NAME                           GSOB_SHORT_NAME,
         GSOB.CHART_OF_ACCOUNTS_ID                 GSOB_CHART_OF_ACCOUNTS_ID,
         GSOB.CURRENCY_CODE                        GSOB_CURRENCY_CODE,
         GSOB.PERIOD_SET_NAME                      GSOB_PERIOD_SET_NAME,
         GSOB.ACCOUNTED_PERIOD_TYPE                GSOB_ACCOUNTED_PERIOD_TYPE,
         GSOB.SUSPENSE_ALLOWED_FLAG                GSOB_SUSPENSE_ALLOWED_FLAG,
         GSOB.ALLOW_INTERCOMPANY_POST_FLAG         GSOB_ALLOW_INTERCOMPANY_POST_FLAG,
         GSOB.TRACK_ROUNDING_IMBALANCE_FLAG        GSOB_TRACK_ROUNDING_IMBALANCE_FLAG,
         GSOB.ENABLE_AVERAGE_BALANCES_FLAG         GSOB_ENABLE_AVERAGE_BALANCES_FLAG,
         GSOB.ENABLE_BUDGETARY_CONTROL_FLAG        GSOB_ENABLE_BUDGETARY_CONTROL_FLAG,
         GSOB.REQUIRE_BUDGET_JOURNALS_FLAG         GSOB_REQUIRE_BUDGET_JOURNALS_FLAG,
         GSOB.ENABLE_JE_APPROVAL_FLAG              GSOB_ENABLE_JE_APPROVAL_FLAG,
         GSOB.ENABLE_AUTOMATIC_TAX_FLAG            GSOB_ENABLE_AUTOMATIC_TAX_FLAG,
         GSOB.CONSOLIDATION_SOB_FLAG               GSOB_CONSOLIDATION_SOB_FLAG,
         GSOB.TRANSLATE_EOD_FLAG                   GSOB_TRANSLATE_EOD_FLAG,
         GSOB.TRANSLATE_QATD_FLAG                  GSOB_TRANSLATE_QATD_FLAG,
         GSOB.TRANSLATE_YATD_FLAG                  GSOB_TRANSLATE_YATD_FLAG,
         GSOB.MRC_SOB_TYPE_CODE                    GSOB_MRC_SOB_TYPE_CODE,
         GSOB.ALLOW_POSTING_WARNING_FLAG           GSOB_ALLOW_POSTING_WARNING_FLAG,
         GSOB.LAST_UPDATE_DATE                     GSOB_LAST_UPDATE_DATE,
         GSOB.LAST_UPDATED_BY                      GSOB_LAST_UPDATED_BY,
         GSOB.CREATION_DATE                        GSOB_CREATION_DATE,
         GSOB.CREATED_BY                           GSOB_CREATED_BY,
         GSOB.LAST_UPDATE_LOGIN                    GSOB_LAST_UPDATE_LOGIN,
         GSOB.FUTURE_ENTERABLE_PERIODS_LIMIT       GSOB_FUTURE_ENTERABLE_PERIODS_LIMIT,
         GSOB.LATEST_OPENED_PERIOD_NAME            GSOB_LATEST_OPENED_PERIOD_NAME,
         GSOB.LATEST_ENCUMBRANCE_YEAR              GSOB_LATEST_ENCUMBRANCE_YEAR,
         GSOB.RET_EARN_CODE_COMBINATION_ID         GSOB_RET_EARN_CODE_COMBINATION_ID,
         GSOB.CUM_TRANS_CODE_COMBINATION_ID        GSOB_CUM_TRANS_CODE_COMBINATION_ID,
         GSOB.RES_ENCUMB_CODE_COMBINATION_ID       GSOB_RES_ENCUMB_CODE_COMBINATION_ID,
         GSOB.NET_INCOME_CODE_COMBINATION_ID       GSOB_NET_INCOME_CODE_COMBINATION_ID,
         GSOB.ROUNDING_CODE_COMBINATION_ID         GSOB_ROUNDING_CODE_COMBINATION_ID,
         GSOB.TRANSACTION_CALENDAR_ID              GSOB_TRANSACTION_CALENDAR_ID,
         GSOB.DAILY_TRANSLATION_RATE_TYPE          GSOB_DAILY_TRANSLATION_RATE_TYPE,
         GSOB.EARLIEST_UNTRANS_PERIOD_NAME         GSOB_EARLIEST_UNTRANS_PERIOD_NAME,
         GSOB.DESCRIPTION                          GSOB_DESCRIPTION,
         GSOB.ATTRIBUTE1                           GSOB_ATTRIBUTE1,
         GSOB.ATTRIBUTE2                           GSOB_ATTRIBUTE2,
         GSOB.ATTRIBUTE3                           GSOB_ATTRIBUTE3,
         GSOB.ATTRIBUTE4                           GSOB_ATTRIBUTE4,
         GSOB.ATTRIBUTE5                           GSOB_ATTRIBUTE5,
         GSOB.ATTRIBUTE6                           GSOB_ATTRIBUTE6,
         GSOB.ATTRIBUTE7                           GSOB_ATTRIBUTE7,
         GSOB.ATTRIBUTE8                           GSOB_ATTRIBUTE8,
         GSOB.ATTRIBUTE9                           GSOB_ATTRIBUTE9,
         GSOB.ATTRIBUTE10                          GSOB_ATTRIBUTE10,
         GSOB.ATTRIBUTE11                          GSOB_ATTRIBUTE11,
         GSOB.ATTRIBUTE12                          GSOB_ATTRIBUTE12,
         GSOB.ATTRIBUTE13                          GSOB_ATTRIBUTE13,
         GSOB.ATTRIBUTE14                          GSOB_ATTRIBUTE14,
         GSOB.ATTRIBUTE15                          GSOB_ATTRIBUTE15,
         GSOB.CONTEXT                              GSOB_CONTEXT,
         GSOB.GLOBAL_ATTRIBUTE_CATEGORY            GSOB_GLOBAL_ATTRIBUTE_CATEGORY,
         GSOB.GLOBAL_ATTRIBUTE1                    GSOB_GLOBAL_ATTRIBUTE1,
         GSOB.GLOBAL_ATTRIBUTE2                    GSOB_GLOBAL_ATTRIBUTE2,
         GSOB.GLOBAL_ATTRIBUTE3                    GSOB_GLOBAL_ATTRIBUTE3,
         GSOB.GLOBAL_ATTRIBUTE4                    GSOB_GLOBAL_ATTRIBUTE4,
         GSOB.GLOBAL_ATTRIBUTE5                    GSOB_GLOBAL_ATTRIBUTE5,
         GSOB.GLOBAL_ATTRIBUTE6                    GSOB_GLOBAL_ATTRIBUTE6,
         GSOB.GLOBAL_ATTRIBUTE7                    GSOB_GLOBAL_ATTRIBUTE7,
         GSOB.GLOBAL_ATTRIBUTE8                    GSOB_GLOBAL_ATTRIBUTE8,
         GSOB.GLOBAL_ATTRIBUTE9                    GSOB_GLOBAL_ATTRIBUTE9,
         GSOB.GLOBAL_ATTRIBUTE10                   GSOB_GLOBAL_ATTRIBUTE10,
         GSOB.SLA_LEDGER_CASH_BASIS_FLAG           GSOB_SLA_LEDGER_CASH_BASIS_FLAG,
         rownum                                    ROW_NUMBER_ID,
         sysdate                                   ROW_CREATION_DATE ,
         sysdate                                   ROW_LAST_UPDATE_DATE
      FROM DEV.LH2_BRONZE_DEV.steph_apps_hr_operating_units hou
      LEFT JOIN DEV.LH2_BRONZE_DEV.steph_apps_HR_ALL_ORGANIZATION_UNITS haou
         ON hou.organization_id = haou.organization_id
      LEFT JOIN DEV.LH2_BRONZE_DEV.steph_apps_hr_locations_all hla
         ON haou.location_id    = hla.LOCATION_ID
      LEFT JOIN DEV.LH2_BRONZE_DEV.steph_apps_gl_sets_of_books gsob
         ON hou.set_of_books_id = gsob.set_of_books_id
